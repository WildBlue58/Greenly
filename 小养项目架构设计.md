# 小养 - 智能植物养护助手

## 项目概述

"小养"是一款基于 React 18+ 的智能植物养护助手，集成 AI 识别、个性化养护计划、生长记录追踪等功能，为用户提供全方位的植物养护解决方案。

## 技术架构设计

### 核心技术栈

#### 前端框架

- **React 18+** - 现代 React 开发
  - 函数式组件 + Hooks 编程
  - 自定义 Hooks 封装业务逻辑
  - React.memo 性能优化
  - 懒加载 (React.lazy + Suspense)

#### 路由管理

- **React Router DOM** - SPA 路由管理
  - 路由守卫 (权限控制)
  - 嵌套路由 (Outlet)
  - 分组路由配置

#### 状态管理

- **Zustand** - 轻量级状态管理
  - 用户信息、植物列表、当前选中植物
  - 全局配置、主题设置
  - 相比 Redux 更简洁的 API

#### 网络请求

- **Axios** - HTTP 客户端
  - 请求/响应拦截器
  - 统一错误处理
  - API 代理配置

#### 身份认证

- **JWT** - 用户认证
  - Token 存储和管理
  - 自动刷新机制
  - 路由权限控制

### 构建工具

#### 开发环境

- **Vite** - 现代构建工具
  - 快速热重载
  - 环境变量配置 (.env.local)
  - 路径别名配置
  - 插件系统

#### 开发依赖

- **vite-plugin-mock** - Mock 数据
  - 接口模拟
  - 开发环境数据模拟

### UI 和样式

#### UI 组件库

- **React Vant** - 移动端 UI 组件库
  - 70% 常用组件已封装
  - 适合移动端业务场景
  - 响应式设计

#### 样式解决方案

- **CSS Modules** - 模块化样式

  - 样式隔离
  - 避免样式冲突

- **Stylus** - CSS 预处理器
  - 变量定义
  - 嵌套语法
  - 混合 (Mixins)
  - 函数

#### 移动端适配

- **lib-flexible** - 阿里移动端适配方案

  - 动态设置 html font-size
  - 1rem = 屏幕宽度 / 10
  - 等比例缩放

- **PostCSS + postcss-pxtorem** - 自动化单位转换
  - px 自动转换为 rem
  - 设计稿还原 (750px 设计稿)
  - 自动化单位换算

### AI 和 LLM 集成

#### 大语言模型集成

- **Chat 功能**
  - 支持多模型切换 (DeepSeek, Kimi, Doubao)
  - 流式输出
  - 上下文管理 (LRU 缓存)
  - 参数抽象化

#### AI 功能

- **文生图** - 图像生成
- **Coze 工作流** - 工作流调用
- **多语言支持**

### 工具和库

#### 事件通信

- **Mitt** - 事件总线
  - 跨组件通信
  - 观察者模式
  - 组件解耦

#### 工具函数

- **ES6+ 特性**
  - Array.findIndex
  - String.startsWith
  - Promise
  - Array.from
  - 解构赋值
  - 箭头函数

## 项目目录结构

```bash
src/
├── components/           # 通用组件
│   ├── common/          # 基础组件
│   │   ├── Button/
│   │   ├── Input/
│   │   ├── Modal/
│   │   └── Loading/
│   ├── plant/           # 植物相关组件
│   │   ├── PlantCard/
│   │   ├── PlantDetail/
│   │   ├── PlantForm/
│   │   └── PlantList/
│   ├── care/            # 养护相关组件
│   │   ├── CarePlan/
│   │   ├── CareRecord/
│   │   ├── CareReminder/
│   │   └── CareStats/
│   ├── ai/              # AI 相关组件
│   │   ├── PlantRecognition/
│   │   ├── ChatBot/
│   │   ├── ImageGenerator/
│   │   └── Diagnosis/
│   └── layout/          # 布局组件
│       ├── Header/
│       ├── Footer/
│       ├── Sidebar/
│       └── Navigation/
├── pages/               # 页面组件
│   ├── home/            # 首页
│   │   ├── index.tsx
│   │   └── style.module.styl
│   ├── plant/           # 植物管理
│   │   ├── list/
│   │   ├── detail/
│   │   ├── add/
│   │   └── edit/
│   ├── care/            # 养护管理
│   │   ├── plan/
│   │   ├── record/
│   │   ├── reminder/
│   │   └── stats/
│   ├── ai/              # AI 功能
│   │   ├── recognition/
│   │   ├── chat/
│   │   ├── generate/
│   │   └── diagnosis/
│   ├── user/            # 用户中心
│   │   ├── profile/
│   │   ├── settings/
│   │   ├── login/
│   │   └── register/
│   └── error/           # 错误页面
│       ├── 404.tsx
│       └── 500.tsx
├── store/               # 状态管理
│   ├── index.ts         # 状态入口
│   ├── user.ts          # 用户状态
│   ├── plant.ts         # 植物状态
│   ├── care.ts          # 养护状态
│   ├── ai.ts            # AI 状态
│   └── app.ts           # 应用状态
├── hooks/               # 自定义 Hooks
│   ├── usePlant.ts      # 植物相关
│   ├── useCare.ts       # 养护相关
│   ├── useAI.ts         # AI 相关
│   ├── useAuth.ts       # 认证相关
│   ├── useNotification.ts # 通知相关
│   └── useLocalStorage.ts # 本地存储
├── api/                 # API 接口
│   ├── index.ts         # API 配置
│   ├── user.ts          # 用户接口
│   ├── plant.ts         # 植物接口
│   ├── care.ts          # 养护接口
│   ├── ai.ts            # AI 接口
│   └── upload.ts        # 上传接口
├── mock/                # Mock 数据
│   ├── user.ts
│   ├── plant.ts
│   ├── care.ts
│   └── ai.ts
├── utils/               # 工具函数
│   ├── request.ts       # 请求封装
│   ├── storage.ts       # 存储工具
│   ├── date.ts          # 日期工具
│   ├── image.ts         # 图片工具
│   ├── validation.ts    # 验证工具
│   ├── constants.ts     # 常量定义
│   └── helpers.ts       # 辅助函数
├── styles/              # 样式文件
│   ├── variables.styl   # 样式变量
│   ├── mixins.styl      # 样式混合
│   ├── reset.styl       # 样式重置
│   └── global.styl      # 全局样式
├── types/               # TypeScript 类型定义
│   ├── user.ts
│   ├── plant.ts
│   ├── care.ts
│   ├── ai.ts
│   └── common.ts
├── router/              # 路由配置
│   ├── index.tsx        # 路由入口
│   ├── routes.ts        # 路由定义
│   ├── guards.ts        # 路由守卫
│   └── lazy.ts          # 懒加载配置
├── config/              # 配置文件
│   ├── index.ts         # 主配置
│   ├── api.ts           # API 配置
│   ├── theme.ts         # 主题配置
│   └── constants.ts     # 常量配置
└── assets/              # 静态资源
    ├── images/          # 图片资源
    ├── icons/           # 图标资源
    └── fonts/           # 字体资源
```

## 核心功能模块设计

### 1. 植物识别模块

#### 植物识别功能

- 拍照识别植物品种
- 获取植物详细信息
- 生成养护建议

#### 植物识别实现

```typescript
// hooks/usePlantRecognition.ts
export const usePlantRecognition = () => {
  const [loading, setLoading] = useState(false);
  const [result, setResult] = useState<PlantRecognitionResult | null>(null);

  const recognizePlant = async (imageFile: File) => {
    setLoading(true);
    try {
      const formData = new FormData();
      formData.append("image", imageFile);

      const response = await axios.post("/api/plant/recognize", formData);
      setResult(response.data);
    } catch (error) {
      console.error("植物识别失败:", error);
    } finally {
      setLoading(false);
    }
  };

  return { recognizePlant, loading, result };
};
```

### 2. 养护计划模块

#### 养护计划功能

- 根据植物品种生成个性化养护计划
- 结合环境数据动态调整
- 智能提醒功能

#### 养护计划实现

```typescript
// hooks/useCarePlan.ts
export const useCarePlan = (plantId: string) => {
  const [plan, setPlan] = useState<CarePlan | null>(null);
  const [loading, setLoading] = useState(false);

  const generatePlan = async () => {
    setLoading(true);
    try {
      const response = await axios.post(`/api/care/plan/${plantId}`);
      setPlan(response.data);
    } catch (error) {
      console.error("生成养护计划失败:", error);
    } finally {
      setLoading(false);
    }
  };

  const updatePlan = async (updates: Partial<CarePlan>) => {
    try {
      const response = await axios.put(`/api/care/plan/${plantId}`, updates);
      setPlan(response.data);
    } catch (error) {
      console.error("更新养护计划失败:", error);
    }
  };

  return { plan, loading, generatePlan, updatePlan };
};
```

### 3. AI 聊天模块

#### AI 聊天功能

- 多模型支持 (DeepSeek, Kimi, Doubao)
- 流式输出
- 上下文管理

#### AI 聊天实现

```typescript
// hooks/useAIChat.ts
export const useAIChat = () => {
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [loading, setLoading] = useState(false);

  const sendMessage = async (content: string, model: string = "deepseek") => {
    const userMessage: ChatMessage = {
      id: Date.now().toString(),
      content,
      role: "user",
      timestamp: new Date(),
    };

    setMessages((prev) => [...prev, userMessage]);
    setLoading(true);

    try {
      const response = await axios.post("/api/ai/chat", {
        message: content,
        model,
        history: messages.slice(-10), // 保留最近10条消息
      });

      const aiMessage: ChatMessage = {
        id: (Date.now() + 1).toString(),
        content: response.data.content,
        role: "assistant",
        timestamp: new Date(),
      };

      setMessages((prev) => [...prev, aiMessage]);
    } catch (error) {
      console.error("AI 聊天失败:", error);
    } finally {
      setLoading(false);
    }
  };

  return { messages, loading, sendMessage };
};
```

### 4. 状态管理设计

#### Zustand Store 结构

```typescript
// store/index.ts
import { create } from "zustand";
import { userStore } from "./user";
import { plantStore } from "./plant";
import { careStore } from "./care";
import { aiStore } from "./ai";

export const useStore = create((set, get) => ({
  ...userStore(set, get),
  ...plantStore(set, get),
  ...careStore(set, get),
  ...aiStore(set, get),
}));
```

```typescript
// store/plant.ts
export const plantStore = (set: any, get: any) => ({
  plants: [],
  currentPlant: null,
  loading: false,

  setPlants: (plants: Plant[]) => set({ plants }),
  setCurrentPlant: (plant: Plant | null) => set({ currentPlant: plant }),
  setLoading: (loading: boolean) => set({ loading }),

  fetchPlants: async () => {
    set({ loading: true });
    try {
      const response = await axios.get("/api/plants");
      set({ plants: response.data });
    } catch (error) {
      console.error("获取植物列表失败:", error);
    } finally {
      set({ loading: false });
    }
  },

  addPlant: async (plantData: Partial<Plant>) => {
    try {
      const response = await axios.post("/api/plants", plantData);
      const newPlant = response.data;
      set((state) => ({ plants: [...state.plants, newPlant] }));
      return newPlant;
    } catch (error) {
      console.error("添加植物失败:", error);
      throw error;
    }
  },
});
```

## 性能优化策略

### 1. React 性能优化

- **useCallback** - 函数记忆化
- **useMemo** - 值记忆化
- **React.memo** - 组件记忆化
- **懒加载** - 路由和图片懒加载

### 2. 防抖节流

- **防抖 (Debounce)** - 搜索输入优化
- **节流 (Throttle)** - 滚动事件优化

### 3. 用户体验优化

- **骨架屏 (Skeleton)** - 加载状态优化
- **图片懒加载** - IntersectionObserver API
- **瀑布流布局** - 两列响应式布局
- **无限滚动** - 滚动加载更多

## 设计模式和编程规范

### 设计模式

- **单例模式** - 全局状态管理
- **观察者模式** - 事件通信
- **组件模式** - 组件封装

### 编程规范

- **Git 提交规范** - 规范化提交信息
- **代码风格** - ESLint + Prettier
- **JavaScript** - 类型安全

## 开发环境配置

### 移动端配置

- **viewport** - user-scalable=no 禁止用户缩放
- **rem 适配** - 移动端等比例缩放
- **触摸事件** - 移动端交互优化

### 样式重置

- **CSS Reset** - 样式重置
- **box-sizing** - border-box
- **font-family** - 系统字体

## 部署和运维

### 环境变量

- **.env.local** - 本地环境配置
- **API Keys** - LLM API 密钥管理

### 性能监控

- **Bundle 分析** - 打包体积优化
- **性能指标** - Core Web Vitals

## 技术亮点总结

1. **移动端适配** - lib-flexible + postcss-pxtorem 完美还原设计稿
2. **性能优化** - 多层次的性能优化策略
3. **AI 集成** - 灵活的 LLM 集成方案
4. **用户体验** - 骨架屏、懒加载、瀑布流等优化
5. **代码质量** - JavaScript + ESLint + 设计模式
6. **开发效率** - Vite + 组件库 + 自定义 Hooks

这个技术栈涵盖了现代 React 开发的各个方面，从基础框架到性能优化，从移动端适配到 AI 集成，形成了一个完整的技术体系。
